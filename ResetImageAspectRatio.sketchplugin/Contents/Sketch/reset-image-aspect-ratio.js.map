{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/reset-image-aspect-ratio.js","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/ui\""],"names":["UI","require","DOM","onReset","context","document","getSelectedDocument","selectedLayers","layers","length","bitmaps","filter","layer","type","rectangles","isRectangle","hasPatternFill","forEach","originalSize","image","nsimage","size","resetBitmap","style","fills","sketchObject","NSImage","resetRectangle","imageCount","message","patternFills","fill","enabled","layerCount","count","layerClass","class","MSRectangleShape","currentAspectRatio","frame","width","height","originalAspectRatio","setConstrainProportions","scale","Math","round"],"mappings":"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","file":"reset-image-aspect-ratio.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/reset-image-aspect-ratio.js\");\n","var UI = require('sketch/ui'),\n    DOM = require('sketch/dom');\n\nexport function onReset(context) {\n  var document = DOM.getSelectedDocument(),\n      selectedLayers = document.selectedLayers.layers;\n\n  if (selectedLayers.length > 0) {\n\n    let bitmaps = selectedLayers.filter(layer => layer.type === 'Image');\n    let rectangles = selectedLayers.filter(layer => isRectangle(layer) && hasPatternFill(layer));\n\n    bitmaps.forEach(layer => {\n      let originalSize = layer.image.nsimage.size();\n      resetBitmap(layer, originalSize);\n    });\n\n    rectangles.forEach(layer => {\n      let originalSize = layer.style.fills[0].sketchObject.image().NSImage().size();\n      resetRectangle(layer, originalSize);\n    });\n\n    let imageCount = bitmaps.length + rectangles.length;\n    switch (imageCount) {\n      case 0:\n        UI.message('No images were found');\n        break;\n      case 1:\n        UI.message('1 image reset');\n        break;\n      default:\n        UI.message(`${imageCount} images reset`);\n    }\n\n  } else {\n    UI.message('Select one or more images');\n  }\n\n}\n\nfunction hasPatternFill(layer) {\n  let patternFills = layer.style.fills.filter(fill => fill.fill === 'Pattern' && fill.enabled);\n  return (patternFills.length === 1);\n}\n\nfunction isRectangle(layer) {\n  if (layer.type === 'Shape') {\n    let layerCount = layer.sketchObject.layers().count();\n    let layerClass = layer.sketchObject.layers()[0].class();\n\n    if (layerCount === 1 && layerClass === MSRectangleShape) {\n      return true;\n    } else {\n      return false;\n    }\n  } else {\n    return false;\n  }\n}\n\nfunction resetBitmap(layer, originalSize) {\n\n  let currentAspectRatio = layer.frame.width / layer.frame.height;\n  let originalAspectRatio = originalSize.width / originalSize.height;\n\n  layer.sketchObject.setConstrainProportions(0);\n\n  if (currentAspectRatio > originalAspectRatio) {\n    layer.frame = layer.frame.scale(1, currentAspectRatio / originalAspectRatio);\n  } else {\n    layer.frame = layer.frame.scale(originalAspectRatio / currentAspectRatio, 1);\n  }\n\n  layer.sketchObject.setConstrainProportions(1);\n\n}\n\nfunction resetRectangle(layer, originalSize) {\n\n  let currentAspectRatio = layer.frame.width / layer.frame.height;\n  let originalAspectRatio = originalSize.width / originalSize.height;\n\n  layer.sketchObject.setConstrainProportions(0);\n\n  let frame = layer.frame;\n\n  if (currentAspectRatio > originalAspectRatio) {\n    frame.width = Math.round(frame.width);\n    frame.height = Math.round(frame.width / originalAspectRatio);\n  } else {\n    frame.height = Math.round(frame.height);\n    frame.width = Math.round(frame.height * originalAspectRatio);\n  }\n\n  layer.frame = frame;\n\n  layer.sketchObject.setConstrainProportions(1);\n\n}\n","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}